/*!
 * jQuery.mpic
 *
 * @version 1.0
 * @author Kazuhiro Shintani
 * @license MIT License (https://github.com/nbnote/jquery-mpic/blob/master/LICENSE)
 * @link https://github.com/nbnote/jquery-mpic
 */
;(function($,k,l,m){var n='mpic';var o={numFrames:0,align:5,lq:'',hq:'',onLoadProgress:function(){},onLoadComplete:function(){},onUpdate:function(){}};var p={_init:function(d,e){this.options=$.extend({},o,e);this.$element=d;this.$element.data(n,this);var f=this.options;if(!f.numFrames||!f.lq)return;this.$window=$(k);this.$document=$(l);this.hq=f.hq!=='';this.currentFrame=0;this.width=0;this.height=0;this.winWidth=0;this.winHeight=0;this.running=false;this.timerId=0;this.$lq=$('<img/>').css({position:'absolute'});this.$hq=$('<img/>').css({position:'absolute'});switch(f.align){case 1:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);return{width:this.width*a,height:this.height*a,bottom:0,left:0}};break;case 2:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);var b=this.width*a;return{width:b,height:this.height*a,bottom:0,left:(b-this.winWidth)/2*-1}};break;case 3:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);return{width:this.width*a,height:this.height*a,bottom:0,right:0}};break;case 4:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);var b=this.height*a;return{width:this.width*a,height:b,top:(b-this.winHeight)/2*-1,left:0}};break;case 5:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);var b=this.width*a;var c=this.height*a;return{width:b,height:c,top:(c-this.winHeight)/2*-1,left:(b-this.winWidth)/2*-1}};break;case 6:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);var b=this.height*a;return{width:this.width,height:b,top:(b-this.winHeight)/2*-1,right:0}};break;case 7:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);return{width:this.width*a,height:this.height*a,top:0,left:0}};break;case 8:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);var b=this.width*a;return{width:b,height:this.height*a,top:0,left:(b-this.winWidth)/2*-1}};break;case 9:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);return{width:this.width*a,height:this.height*a,top:0,right:0}};break;default:this._makeImgStyle=function(){var a=Math.max(this.winWidth/this.width,this.winHeight/this.height);var b=this.width*a;var c=this.height*a;return{width:b,height:c,top:(c-this.winHeight)/2*-1,left:(b-this.winWidth)/2*-1}};break}var g=[];var h=f.lq.split('{{index}}');var i=1;for(;i<=f.numFrames;i++){g.push(h[0]+i+h[1])}var j=new q(g);j.onProgress=$.proxy(this._onLoadProgress,this);j.onComplete=$.proxy(this._onLoadComplete,this);j.load()},_onLoadError:function(a){var b={type:'loaderror',data:a};this.options.onLoadError.call(this.$element[0],b)},_onLoadProgress:function(a){var b={type:'loadprogress',percent:a.percent,data:a};this.options.onLoadProgress.call(this.$element[0],b)},_onLoadComplete:function(a){var b=this.options;if(this.hq){var c=b.hq.split('{{index}}');var i=a.length;for(;i--;){a[i].hq=c[0]+(i+1)+c[1]}}this.dataList=a;var d={type:'loadcomplete',data:this.dataList};b.onLoadComplete.call(this.$element[0],d);var e=this.dataList[0].img;this.width=e.width;this.height=e.height;this.$element.css({overflow:'hidden'}).append(this.$lq);if(this.hq){this.$element.append(this.$hq)}this.$window.on('scroll',$.proxy(this._setFrame,this)).on('resize',$.proxy(this._update,this));this._setFrame();this._update()},_setFrame:function(){var a=this.$document.height()-this.$window.height();var b=this.$document.scrollTop();var c=a/(this.options.numFrames-1);this.currentFrame=Math.floor(b/c)||0;this.$hq.hide();this.$lq.attr({src:this.dataList[this.currentFrame].src});if(this.hq){this._setHQImgBegin()}var d={type:'update',frameNumber:this.currentFrame+1,data:this.dataList[this.currentFrame]};this.options.onUpdate.call(this.$element[0],d)},_setHQImgBegin:function(){if(this.running){this.running=false;clearTimeout(this.timerId)}this.running=true;var a=this;this.timerId=setTimeout(function(){a.running=false;a._setHQImg()},500)},_setHQImg:function(){var a=new Image();var b=this.dataList[this.currentFrame].hq;var c=this;a.onload=function(){c.$hq.attr({src:b}).fadeIn(500)};a.src=b},_makeImgStyle:function(){},_update:function(){this.winWidth=this.$window.width();this.winHeight=this.$window.height();var a=this._makeImgStyle();this.$element.css({width:this.winWidth,height:this.winHeight});this.$lq.css(a);if(this.hq){this.$hq.css(a)}}};$[n]=function(){};$.extend($[n].prototype,p);$.fn[n]=function(a){if(p[a]&&a.charAt(0)!=='_'){var b=arguments;if(a.substr(0,3)==='get'){return p[a].apply($(this).data(n),Array.prototype.slice.call(b,1))}else{return this.each(function(){p[a].apply($(this).data(n),Array.prototype.slice.call(b,1))})}}else if(typeof a==='object'||!a){return this.each(function(){new $[n]()._init($(this),a)})}else{$.error('Method '+a+' does not exist on jQuery.'+n)}};var q=function(b){this.numPipes=6;this.numImages=0;this.numLoadings=0;this.numLoaded=0;this.registerList=[];var i=0;var c=b.length;for(;i<c;i++){this.registerList[i]={src:b[i]}}this.loadedList=[];this.successList=[];this.errorList=[];this.onProgress=function(a){};this.onError=function(a){};this.onComplete=function(a){}};q.prototype={load:function(){this.numImages=this.registerList.length;if(this.numImages===0){this.onComplete(this.loadedList);return}var i=0;for(;i<this.numImages;i++){this.registerList[i].id=i}i=0;var a=this.numLoadings=Math.min(this.numPipes,this.numImages);for(;i<a;i++){this._load(this.registerList[i])}},_next:function(){if(this.numImages===this.numLoaded){this.onComplete(this.loadedList)}else if(this.numLoadings<this.numImages){this._load(this.registerList[this.numLoadings]);this.numLoadings++}},_load:function(a){var b=this;var c=a.img=new Image();c.onload=function(){setTimeout(function(){b.numLoaded++;a.percent=b.numLoaded/b.numImages*100|0;a.result='success';b.loadedList[a.id]=a;b.successList.push(a);b.onProgress(a);b._next()},25)};c.onerror=function(){setTimeout(function(){b.numLoaded++;a.result='error';b.loadedList[a.id]=a;b.errorList.push(a);b.onError(a);b._next()},25)};c.src=a.src||'none'}}})(jQuery,window,document);

